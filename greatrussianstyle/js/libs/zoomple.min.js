!function(t){var o,e={getInstance:function(){return o||(o=function(){var o,e,i,s={};function h(){o.trigger("hideoverlay.zoomple"),o.css({left:"auto",top:"auto",width:"auto",height:"auto",display:"none"})}return o=t('<div id="zoomple_image_overlay"><div class="eyelet"></div></div>').appendTo("body"),i=o.find(".eyelet"),o.on("mouseleave",h),o.on("mouseenter",(function(){e&&(clearTimeout(e),e=null)})),{showOverlay:function(t){o.trigger("showoverlay.zoomple"),o.css({left:t.offset().left,top:t.offset().top,width:t.width(),height:t.height(),display:"block"})},hideOverlay:h,delayedHideOverlay:function(){e=setTimeout(h,100)},getEl:function(){return o},setEyletSize:function(t,o){i.css({width:t,height:o}),s.width=t,s.height=o},getEyletSize:function(){return s},getEylet:function(){return i},moveEylet:function(t){return i.css(t)},clearEylet:function(){return i.css({background:"transparent"})}}}()),o}},i=function(o,e){this.$element=t(o),this.options=t.extend({},i.DEFAULTS,e),this.timer=null,this.pageX=null,this.pageY=null,this.$cursor=null,this.$holder=null,this.overlay=null,this.$overlay=null,this.stopLoading=!1,this.init()};i.DEFAULTS={attachWindowToMouse:!0,blankURL:"images/blank.gif",bgColor:"#fff",delay:1,loaderURL:"images/loader.gif",offset:{x:5,y:5},roundedCorners:!1,source:"href",showCursor:!1,showOverlay:!1,windowPosition:{x:"right",y:"top"},zoomWidth:300,zoomHeight:300},i.prototype.init=function(){this.options.showOverlay&&(this.options.attachWindowToMouse=!1,this.options.showCursor=!1),t("#zoomple_previewholder").length||t("body").append('<div id="zoomple_previewholder" style="width:'+this.options.zoomWidth+"px;height:"+this.options.zoomHeight+'px;"><div class="overlay"></div><div class="cursor"></div><div class="image_wrap"><img src="'+this.options.blankURL+'" alt="" /></div> <div class="caption-wrap"></div> </div>'),this.$holder=t("#zoomple_previewholder"),this.overlay=e.getInstance(),this.$overlay=this.overlay.getEl(),this.$cursor=this.$holder.find(".cursor"),this.$element.find("img").on("mouseenter.zoomple",t.proxy(this.showZoom,this,this.$element.find("img"))),this.$element.find("img").on("mouseleave.zoomple",t.proxy(this.hideOverlay,this))},i.prototype.showZoom=function(o,e){e.preventDefault(),e.stopPropagation(),this.$overlay.on("hideoverlay.zoomple",t.proxy(this.hideZoom,this)),this.$overlay.on("mousemove.zoomple",t.proxy(this.moveZoom,this,this.$element.find("img"))),this.overlay.showOverlay(this.$element.find("img"));var i=this.options;e=t.Event("zoomshow.zoomple",{zoomple:this});this.$element.trigger(e),e.isDefaultPrevented()||(this.setOverlay(),this.setCursor(),this.setRounded(),this.setImageOverlay(),this.delaier(o.parent().attr(i.source),o.attr("alt")))},i.prototype.hideZoom=function(o){o&&o.stopPropagation&&o.stopPropagation(),o&&o.preventDefault&&o.preventDefault(),clearTimeout(this.timer),this.$overlay.off("hideoverlay.zoomple"),this.$overlay.off("mousemove.zoomple"),this.stopLoading=!1,this.$holder.find("img").css({background:" url("+this.options.blankURL+") 50% 50% no-repeat",left:"auto",top:"auto",width:"auto",height:"auto"}),this.$holder.find("p").html(""),this.$holder.removeClass("zp-visible");o=t.Event("zoomhide.zoomple",{zoomple:this});this.$element.trigger(o),this.hideImageOverlay(),this.clearEylet(),this.clearCaption()},i.prototype.moveZoom=function(t,o){o.preventDefault(),o.stopPropagation(),this.pageX=o.pageX,this.pageY=o.pageY,this.positionZoom(t,o)},i.prototype.hideOverlay=function(t){this.overlay.delayedHideOverlay()},i.prototype.positionZoom=function(o,e){var i=this.options,s=(e.pageX-o.offset().left)/o.width()*100,h=(e.pageY-o.offset().top)/o.height()*100;if(this.options.attachWindowToMouse)thumbPosition={left:e.pageX,top:e.pageY,right:Math.round(t(window).width()-(e.pageX-i.offset.x)),bottom:Math.round(t(window).height()-(e.pageY-i.offset.y))},t(window).height()+t(window).scrollTop()-i.zoomHeight-i.offset.y>thumbPosition.top?this.$holder.css({top:Math.round(thumbPosition.top+i.offset.y)+"px"}):this.$holder.css({top:Math.round(thumbPosition.top-i.zoomHeight-i.offset.y)+"px"}),t(window).width()+t(window).scrollLeft()-i.zoomWidth-i.offset.x>thumbPosition.left?this.$holder.css({left:Math.round(thumbPosition.left+i.offset.x)+"px"}):this.$holder.css({left:Math.round(thumbPosition.left-i.zoomWidth-i.offset.x)});else{var r=Math.round(o.offset().left-i.offset.x-i.zoomWidth),n=Math.round(o.offset().left+o.width()+i.offset.x),l=Math.round(o.offset().top-i.offset.y),a=Math.round(o.offset().top+o.height()-i.zoomHeight+i.offset.y);"top"==i.windowPosition.y&&this.$holder.css({top:l+"px"}),"left"==i.windowPosition.x&&this.$holder.css({left:r+"px"}),"bottom"==i.windowPosition.y&&this.$holder.css({top:a+"px"}),"right"==i.windowPosition.x&&this.$holder.css({left:n+"px"})}var d=this.$holder.find("img"),p=-(d.width()-i.zoomWidth)*s/100,f=-(d.height()-i.zoomHeight)*h/100;if((i.showCursor||i.roundedCorners)&&(p+=i.zoomWidth*(50-s)/100,f+=i.zoomHeight*(50-h)/100),this.$cursor.css({left:"50% ",top:"50%"}),this.options.showOverlay){var u=this.moveEylet(Math.round(e.pageX-o.offset().left),Math.round(e.pageY-o.offset().top)),m=d.width(),g=d.height();this.moveImageOverlay(-Math.round(m*u.x),-Math.round(g*u.y),d)}else d.css({left:p+"px ",top:f+"px"})},i.prototype.delaier=function(o,e){this.stopLoading=!0,this.timer=setTimeout(t.proxy(this.delaiedZoom,this,o,e),this.options.delay)},i.prototype.delaiedZoom=function(o,e){var i=this;i.$holder.css({width:i.options.zoomWidth+"px",height:i.options.zoomHeight+"px"}),i.$holder.find(".image_wrap").css({background:" url("+i.options.loaderURL+") 50% 50% no-repeat"});var s=new Image;src=o+"?"+(new Date).getTime(),s.src=src,i.stopLoading&&(i.$holder.addClass("zp-visible"),i.$holder.find("img").attr("src",src),t.trim(e).length&&i.$holder.find(".caption-wrap").html('<div class="caption">'+e+"</div>")),t(s).load((function(){if(i.stopLoading){i.$holder.addClass("zp-visible"),i.$holder.find(".image_wrap").css({background:i.options.bgColor}),i.$holder.find("img").css({width:this.width+"px",height:this.height+"px"}).attr({src:src,width:this.width,height:this.height}),i.$holder.css({"background-image":" none"}),t.trim(e).length&&i.$holder.find(".caption-wrap").html('<div class="caption">'+e+"</div>");var o={pageX:i.pageX,pageY:i.pageY};i.options.showOverlay&&i.setupEylet(),i.positionZoom(i.$element.find("img"),o)}}))},i.prototype.setCursor=function(){this.options.showCursor?this.$cursor.css("display","block"):this.$cursor.css("display","none")},i.prototype.setRounded=function(){this.options.roundedCorners?this.$holder.addClass("rounded"):this.$holder.removeClass("rounded")},i.prototype.setOverlay=function(){this.options.showOverlay?this.$overlay.addClass("preview"):this.$overlay.removeClass("preview")},i.prototype.setupEylet=function(){var t=this.overlay.getEylet(),o=this.$element.find("img"),e=this.$holder.find("img"),i=this.options.zoomWidth/e.width(),s=this.options.zoomHeight/e.height();t.css({background:"url("+o.attr("src")+") 0 0 no-repeat"}),this.overlay.setEyletSize(Math.round(i*o.width()),Math.round(s*o.height()))},i.prototype.clearEylet=function(){this.overlay.clearEylet()},i.prototype.moveEylet=function(t,o){var e=this.overlay.getEylet(),i=this.overlay.getEyletSize(),s=Math.round(t-i.width/2),h=Math.round(o-i.height/2),r=this.$element.find("img");return s<=0&&(s=0),s>=r.width()-i.width&&(s=r.width()-i.width),h<=0&&(h=0),h>=r.height()-i.height&&(h=r.height()-i.height),this.overlay.moveEylet({top:h,left:s}),e.css({backgroundPosition:-s+"px "+-h+"px"}),{x:s/r.width(),y:h/r.height()}},i.prototype.setImageOverlay=function(){var o=t("#zoomple_image_overlay"),e=this.$element.is("img")?this.$element:this.$element.find("img");o.css({left:Math.round(e.offset().left),top:Math.round(e.offset().top),width:e.width(),height:e.height()})},i.prototype.hideImageOverlay=function(){t("#zoomple_image_overlay").css({left:"auto",top:"auto",width:"auto",height:"auto"})},i.prototype.moveImageOverlay=function(t,o,e){var i=this.options.zoomWidth,s=this.options.zoomHeight;t>=0&&(t=0),t<=i-e.width()&&(t=i-e.width()),o>=0&&(o=0),o<=s-e.height()&&(o=s-e.height()),e.css({left:t+"px ",top:o+"px"})},i.prototype.clearCaption=function(){this.$holder.find(".caption").remove()},t.fn.zoomple=function(o){return this.each((function(){t.data(this,"zoomple")||t.data(this,"zoomple",new i(this,o))}))}}(jQuery);